---
interface Props {
    src: string;
    background?: boolean;
    title?: boolean;
    byline?: boolean;
    autoplay?: boolean;
    muted?: boolean;
    loop?: boolean;
}

const { src, background, title, byline, autoplay, muted, loop } = Astro.props;

const url = new URL(src);

if (url.hostname.endsWith("vimeo.com")) {
    url.hostname = "player.vimeo.com";
    url.pathname = url.pathname.replace(/^(\/.*\/)(\d*)$/, "/video/$2");

    if (background) {
        // url.searchParams.append("title", "0");
        // url.searchParams.append("byline", "0");
        // url.searchParams.append("portrait", "0");
        url.searchParams.append("background", "1");
        // url.searchParams.append("autoplay", "1");
        // url.searchParams.append("muted", "1");
        // url.searchParams.append("loop", "1");
    } else {
        url.searchParams.append("title", title ? "1" : "0");
        url.searchParams.append("byline", byline ? "1" : "0");
        url.searchParams.append("muted", muted || autoplay ? "1" : "0");
        url.searchParams.append("autoplay", autoplay ? "1" : "0");
        url.searchParams.append("loop", loop ? "1" : "0");
    }

    url.searchParams.append("dnt", "1");
}
---

<div class:list={["video-wrapper", { background }]}>
    <iframe src={url.toString()} allowfullscreen allow="autoplay"></iframe>
</div>
<style lang="scss">
    .video-wrapper.background {
        position: absolute;
        overflow: hidden;

        inset: 0;
        width: 100%;
        height: 100%;
        container: video-wrapper / size;

        iframe {
            position: absolute;
            height: max(56.25cqw, 100cqh);
            width: max(177.778cqh, 100cqw);
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }
    }

    iframe {
        width: 100%;
        height: auto;
        aspect-ratio: 16/9;
    }
</style>

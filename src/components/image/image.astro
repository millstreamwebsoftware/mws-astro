---
import Markdown from "@shared/Markdown.astro";
import Lightbox from "@components/lightbox/lightbox.astro";

export interface Props {
  image: any;
  title?: string;
  description?: string;
  height: number;
  columns: number;
  indent: boolean;
  "background-color"?: string;
  lightbox?: boolean;
  key?: string;
}

const { image, title, description, height, indent, "background-color": background, lightbox, key } = Astro.props;

const id = `image${key}`;
---

<section
  {id}
  class:list={["image", {"no-indent": !indent}, {lightbox}]}
  style={{...(height && {"--height": height})}}
>
      <figure data-lightbox={lightbox && id}>
        <img
          src={image?.src || image}
          alt=""
          loading="lazy"
          decoding="async"
          style={{
            ...(image?.width && {
              "max-width": `${image?.width}px`,
            }),
            ...(image?.height && {
              "max-height": `${image?.height}px`,
            }),
          }}
        />

        {(title || description) && (
          <figcaption style="">
            {title && <h3>{title}</h3>}
            {description && (
              <Markdown content={description} />
            )}
          </figcaption>
        )}
      </figure>

  {
    lightbox && (
      <Lightbox collection={id}>
          <figure
            data-lightbox={id}
            class:list={{ caption: title || description }}
          >
            <img
              src={image?.src || image}
              alt=""
              loading="lazy"
              decoding="async"
              style={{
                ...(image?.width && {
                  "max-width": `${image?.width}px`,
                }),
                ...(image?.height && {
                  "max-height": `${image?.height}px`,
                }),
              }}
            />

            {(title || description) && (
              <figcaption>
                {title && <h3>{title}</h3>}
                {description && (
                  <Markdown content={description} />
                )}
              </figcaption>
            )}
          </figure>
      </Lightbox>
    )
  }
</section>

<style lang="scss">
  figure {
    height: calc(var(--height) * 1vh);
    background-color: rgb(var(--background-color));
    display: flex;
    flex-direction: column;
    gap: var(--column-gap);
    width: 100%;
  }

  figcaption {
    flex: 1 1 0;
    padding: 0 var(--indent);
    padding-bottom: calc(var(--indent) * .5);
  }

  img {
    width: 100%;
    height: 0;
    flex: 1 1 100%;

    object-fit: cover;
    object-position: center;
  }

  .lightbox [data-lightbox] {
    cursor: pointer;
  }
</style>

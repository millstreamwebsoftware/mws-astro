---
import preferences from "@data/preferences.json";
import Footer from "@shared/Footer.astro";
import Header from "@shared/Header.astro";
import Opengraph from "@shared/Opengraph.astro";
import type { CollectionEntry, CollectionKey } from "astro:content";

import * as git from "git-rev-sync";

import "@custom/custom.scss";
import "@styles/styles.scss";
import "sanitize.css";
import "sanitize.css/forms.css";
import "sanitize.css/typography.css";

export interface Props {
  page: CollectionEntry<CollectionKey>,
  classes: string;
}

const {classes} = Astro.props;

const {
  title,
  description,
  show_global_header,
  show_global_footer,
  thumbnail,
  status = "online",
} = Astro.props.page.data;

const pageWidth = preferences.page.maximum_page_width;
---

<!doctype html>
<html
  lang="en"
  class:list={classes}
  style={{ ...(pageWidth && { "--page-max-width": `${pageWidth}px` }) }}
>
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,viewport-fit=cover"
    />
    <meta name="generator" content={Astro.generator} />
    <meta name="revision" content={git.long("./")} />
    <meta name="format-detection" content="telephone=no" />
    {status !== "online" && <meta name="robots" content="noindex" />}
    <link rel="sitemap" href="/sitemap-index.xml" />

    <Opengraph {title} {description} {thumbnail} />

    <script>
      window.addEventListener(
        "scroll",
        () => {
          if (document.documentElement.classList.contains("mobile-noscroll"))
            return;
          document.documentElement.classList.toggle(
            "scrolled",
            window.scrollY > 100,
          );
        },
        { passive: true },
      );
    </script>
  </head>
  <body>
    {show_global_header && <Header />}
    <article>
      <slot />
      {show_global_footer && <Footer />}
    </article>
  </body>
</html>
